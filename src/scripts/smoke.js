console.clear(),canvasWidth=1600,canvasHeight=200,pCount=0,pCollection=new Array;var puffs=1,particlesPerPuff=2e3,img="https://s3-us-west-2.amazonaws.com/s.cdpn.io/85280/smoke2.png",smokeImage=new Image;smokeImage.src=img;for(var i1=0;i1<puffs;i1++)for(var puffDelay=1500*i1,i2=0;i2<particlesPerPuff;i2++)addNewParticle(50*i2+puffDelay);function addNewParticle(e){var t={};t.top=canvasHeight,t.left=randBetween(-200,800),t.start=(new Date).getTime()+e,t.life=8e3,t.speedUp=30,t.speedRight=randBetween(0,20),t.rot=randBetween(-1,1),t.red=Math.floor(randBetween(0,255)),t.blue=Math.floor(randBetween(0,255)),t.green=Math.floor(randBetween(0,255)),t.startOpacity=.3,t.newTop=t.top,t.newLeft=t.left,t.size=200,t.growth=10,pCollection[pCount]=t,pCount++}function draw(e,t){var a=(new Date).getTime()-e,n=!0,r=document.getElementsByClassName("smoke-animation"),o=new Array;for(let e=0;e<r.length;e++)o[e]=r[e].getContext("2d"),o[e].clearRect(0,0,r[e].width,r[e].height),r[e].width=r[e].width;for(var i=0;i<pCount;i++){var l=pCollection[i],f=(new Date).getTime()-l.start,s=f/l.life;if(0<f){f<=l.life&&(n=!0);var p=l.top-l.speedUp*(f/1e3),d=l.left+l.speedRight*(f/1e3),w=Math.max(l.startOpacity*(1-s),0),c=l.size+l.growth*(f/1e3);l.newTop=p,l.newLeft=d;for(let e=0;e<o.length;e++)o[e].fillStyle="rgba(150,150,150,"+w+")",o[e].globalAlpha=w,o[e].drawImage(smokeImage,d,p,c,c)}}n?requestAnimationFrame(function(){draw(e,t)}):clog(a+": stopped")}function randBetween(e,t){return Math.random()*(t-e)+e}function randOffset(e,t){var a=1+t,t=1-t;return e*(Math.random()*(a-t)+t)}function clog(e){console.log(e)}draw((new Date).getTime(),3e4);